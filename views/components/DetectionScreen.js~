import React from 'react';
import {
    StyleSheet,
    Text,
    View,
    TouchableOpacity,
    useState,
    useEffect,
    DeviceEventEmitter,
} from 'react-native';
import Beacons from 'react-native-beacons-manager';

function DetectionScreen({navigator}) {
    const [distance, setDistance] = useState();
    const [intensite, setIntensite] = useState();
    const [beaconID, setBeaconID] = useState();
    const [beaconStatus, setBeaconStatus] = useState();
    const [startScan, setScan] = useState();
    
    const Beacon = detectIBeacons();
    useEffect(() => {
	Beacons.startMonitoringForRegion({})
	    .then(() => console.log('Analyse en cour'))
	    .catch(error => console.error('Analyse échouée'));

	Beacons.startRangingForBeaconInRegion(identifier, uuid)
	    .then(() => console.log('Ranging en cour'))
	    .catch(error => console.error('Ranging échouée'));

	const beaconDidRange = DeviceEventEmitter.addListener(
	    'beaconDidRange',
	    (data) => {
		console.log('Beacon a distance', data);
	    }
	);

	const beaconDidEnter = DeviceEventEmitter.addListener(
	    'regionDidEnter',
	    ({identifier, uuid}) => {
		console.log('Beacon enter region');
	    }
	);

	const beaconDidExit = DeviceEventEmitter.addListener(
	    'regionDidExit',
	    ({identifier, uuid}) => {
		console.log('Beacon exit region');
	    }
	);
    }, [startScan]);

    return (
	<View style={{styles.detectBox}}>
	    <Text style={{styles.status}}>{{beaconStatus}}</Text>
	    <View style={{styles.beaconInfos}}>
		<Text style={{styles.infosText}}>Beacon ID: {{beaconID}}</Text>
		<Text style={{styles.infosText}}>Distance : {{distance}}</Text>
		<Text style={{styles.infosText}}>Intensité: {{intensite}}</Text>
	    </View>
	</View>
    )
}

const styles = StyleSheet.create({
    detectBox:{
	display:"flex",
	flexDirection:"column",
	justifyContent:"flex-start",
	alignItems:"center"
    },
    status:{
	fontSize:25,
	textAlign:"center",
	height:100
    },
    beaconInfos:{
	fontSize:25,
	textAlign:"center",
	display:"flex",
	flexDirection:"column",
	justifyContent:"center",
	alignItems:"center",
    },
    infosText:{
	fontSize:25,
	testAlign:"center"
    }
})
